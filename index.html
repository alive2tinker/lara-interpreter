<!DOCTYPE html>
<html>
  <head>
    <title>Monaco Editor in Electron</title>
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self';"> -->
    <script src="node_modules/monaco-editor/min/vs/loader.js"></script>
    <link rel="stylesheet" href="build.css" />
  </head>
  <body>
    <div class="flex">
      <div class="toolbar">
        <ul>
          <li>
            <button id="run-code">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-6"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"
                />
              </svg>
            </button>
          </li>
          <li>
            <button id="select-directory">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-6"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"
                />
              </svg>
            </button>
          </li>
        </ul>
      </div>
      <div class="playground w-full">
        <div id="container" class="w-full min-h-[50vh]"></div>
        <div id="output-container" class="w-full min-h-[50vh]"></div>
      </div>
    </div>
    <script>
      require.config({ paths: { vs: "node_modules/monaco-editor/min/vs" } });

      window.MonacoEnvironment = {
        getWorkerUrl: function (moduleId, label) {
          const blob = new Blob(
            [
              `
                        self.MonacoEnvironment = {
                            baseUrl: 'node_modules/monaco-editor/min/'
                        };
                        importScripts('node_modules/monaco-editor/min/vs/base/worker/workerMain.js');
                        `,
            ],
            { type: "application/javascript" }
          );
          return URL.createObjectURL(blob);
        },
      };

      require(["vs/editor/editor.main"], function () {
        const container = document.getElementById("container");
        const editor = monaco.editor.create(container, {
          value: `<?php
//write your code here`,
          language: "php",
        });

        const runCodeButton = document.getElementById("run-code");
        const outputContainer = document.getElementById("output-container");

        runCodeButton.addEventListener("click", () => {
          let code = editor.getValue();

        //   // Remove '<?php' and '?>' tags
        //   code = code.replace(/^<\?php\s*/, "").replace(/\?>\s*$/, "");

        //   // Remove single-line and multi-line comments
        //   code = code.replace(/\/\/.*|\/\*[\s\S]*?\*\//g, "");

        //   // Trim whitespace to clean any leading/trailing empty lines
        //   code = code.trim();

          // Clear previous output
          outputContainer.textContent = "Running...";

          // Use the exposed Node.js API
          window.nodeAPI.runPHP(code, (result) => {
            if (result.error) {
              outputContainer.innerHTML = `<pre style="color: red;">${result.error}</pre>`;
            } else {
              outputContainer.innerHTML = `<pre>${result.output}</pre>`;
            }
          });
        });
        const resizeEditor = () => {
          const { width, height } = container.getBoundingClientRect();
          editor.layout({ width, height });
        };

        window.addEventListener("resize", resizeEditor);
        resizeEditor();
      });
    </script>
  </body>
</html>
